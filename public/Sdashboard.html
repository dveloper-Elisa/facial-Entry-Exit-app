<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Security dashboard</title>

<style>
*{
    box-sizing:border-box;
    margin:0;
    padding:0;
    font-family:Arial, sans-serif;
}

body{
    background:#f4f4f4;
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:20px;
}

/* Main wrapper */
.all{
    width:100%;
    max-width:600px;
    display:flex;
    flex-direction:column;
    gap:15px;
}

/* Header */
.hed{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.hed a{
    text-decoration:none;
    background:#4CAF50;
    color:white;
    padding:10px 16px;
    border-radius:6px;
    font-weight:bold;
}

.hed a:hover{
    background:#45a049;
}

#logout{
    background:#ff4d4d;
    color:white;
    padding:10px 16px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
}

#logout:hover{
    background:#ff1a1a;
}

/* Card */
.container{
    background:white;
    border-radius:10px;
    box-shadow:0 10px 20px rgba(0,0,0,0.1);
    width:100%;
    padding:20px;
}

/* Title */
.container > p{
    font-size:22px;
    font-weight:bold;
    text-align:center;
    margin-bottom:15px;
}

/* Checkin section */
.checkin-container{
    margin-top:10px;
}

.checkin-container p{
    font-size:16px;
    font-weight:bold;
    margin-bottom:10px;
}

/* Student list */
#student-list{
    background:#eaeaea;
    border-radius:6px;
    padding:12px;
    max-height:200px;
    overflow-y:auto;
}

#student-list p{
    background:white;
    border-radius:5px;
    padding:12px;
    font-size:15px;
    margin-bottom:10px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

/* Action links */
.links{
    margin-top:20px;
    display:flex;
    gap:10px;
}

.links a{
    flex:1;
    text-align:center;
    text-decoration:none;
    color:white;
    background:#4CAF50;
    padding:12px;
    border-radius:6px;
    font-weight:bold;
}

.links a:hover{
    background:#45a049;
}

/* Mobile fit */
@media (max-width:480px){
    .links{
        flex-direction:column;
    }

    #student-list{
        max-height:150px;
    }
}
</style>
</head>

<body>

<div class="all">
    <div class="hed">
        <a href="./manage/control.html">Manage</a>
        <button id="logout">Logout</button>
    </div>

    <div class="container">
        <p>Security Changed</p>

        <div class="checkin-container">
            <p>Checked In</p>
            <div id="student-list">
                <!-- Student list will be displayed here -->
            </div>
        </div>

        <div class="links">
            <a href="checkin.html" id="chekin">Check In</a>
            <a href="home.html" id="Check-otut">Check Out</a>
        </div>
    </div>
</div>

</body>

<!-- ðŸ”´ LOGIC: UNTOUCHED -->
<script>
const sec = localStorage.getItem("sec");
if (!sec || sec === "undefined" || sec == "") {
    location.href = "/";
}

document.getElementById("logout").addEventListener("click", (e) => {
    e.preventDefault()
    localStorage.removeItem("sec")
    window.location.href = "/"
})

checkedClient = async () => {
    if (!sec) {
        window.location.href = "/";
        return;
    }

    try {
        const secObj = JSON.parse(sec);

        const response = await fetch(`/checkedin/${secObj.id}`, {
            method: "GET",
            headers: { "Content-Type": "application/json" }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const students = await response.json();

        const studentListDiv = document.getElementById("student-list");
        studentListDiv.innerHTML = "";

        if (students && students.data.length > 0) {
            const checkin = students.data.filter(status => status.status === "in")
            const checkout = students.data.filter(status => status.status === "out")

            const studentItem = document.createElement("p");
            studentItem.innerHTML =
                "Checked In: <strong style='color:blue'>" + checkin.length + "</strong>";
            studentItem.innerHTML +=
                " | Checked Out: Z <strong style='color:blue'>" + checkout.length + "</strong>";

            studentListDiv.appendChild(studentItem);
        } else {
            const noStudentsMessage = document.createElement("p");
            noStudentsMessage.textContent = "No person checked in.";
            studentListDiv.appendChild(noStudentsMessage);
        }
    } catch (error) {
        console.error(error.message);
        const studentListDiv = document.getElementById("student-list");
        const errorMessage = document.createElement("p");
        errorMessage.textContent = "An error occurred while fetching data.";
        studentListDiv.appendChild(errorMessage);
    }
};

checkedClient();
</script>

</html>
